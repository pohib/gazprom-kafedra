{% extends 'base.html' %}
{% load static %}

{% block title %}Партнёры{% endblock %}

{% block content %}
    <h1 class="text-4xl font-bold text-center text-white mt-8 mb-4 p-4 bg-gradient-to-r from-blue-400 to-blue-500 rounded-lg shadow-lg animate__animated animate__fadeInDown">
        Наши партнёры
    </h1>
    
    <div id="map" class="w-full max-w-6xl mx-auto mt-8 rounded-lg shadow-2xl border-4 border-[#0079C2]" style="height: 650px;"></div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://api-maps.yandex.ru/2.1/?apikey=89fc0b90-6407-4d1f-8057-b1706cd35a07&lang=ru_RU" />
<link href="{% static 'css/map.css' %}" rel="stylesheet">
{% endblock %}

{% block extra_js %}
<script src="https://api-maps.yandex.ru/2.1/?apikey=89fc0b90-6407-4d1f-8057-b1706cd35a07&lang=ru_RU" type="text/javascript"></script>
<script>
ymaps.ready(init);

function init() {
    var myMap = new ymaps.Map("map", {
        center: [61.5240, 105.3188],
        zoom: 3,
        controls: ['zoomControl', 'fullscreenControl', 'typeSelector']
    });

    var partners = [
        {coords: [66.0833, 76.6833], count: 5, name: "Новый Уренгой", companies: "ООО «Газпромнефть Заполярье», ООО «Газпром добыча Ямбург», АО «Ачимгаз», ООО «Ачим Девелопмент», ОАО «Севернефтегазпром»"},
        {coords: [52.2864, 104.3050], count: 2, name: "Иркутск", companies: "ООО «Газпром добыча Иркутск», ООО «Русгазбурение»"},
        {coords: [46.9507, 142.7317], count: 2, name: "Южно-Сахалинск", companies: "ООО «Газпром добыча шельф Южно-Сахалинск», ООО «Сахалинская Энергия»"},
        {coords: [55.7558, 37.6173], count: 1, name: "ООО «Газпром бурение»", companies: "бурение всех скважин ПАО Газпром"},
        {coords: [55.7500, 48.5667], count: 1, name: "АНО ВО Университет Иннополис", companies: "IT решения по задачам ПАО Газпром"},
        {coords: [56.4833, 84.9667], count: 1, name: "ООО «Компания Ойлтим»", companies: "современный сервис по исследованию скважин месторождений ПАО Газпром"},
        {coords: [51.7667, 55.1000], count: 1, name: "ООО «Газпром добыча Оренбург»"},
        {coords: [65.5333, 72.5167], count: 1, name: "ООО «Газпром добыча Надым»"}
    ];

    partners.forEach(function(partner) {
        var size = partner.count > 2 ? 60 : (partner.count > 1 ? 52 : 46);
        
        var balloonContent = `
            <div style="padding: 18px; min-width: 300px;">
                <div style="background: linear-gradient(135deg, #0079C2 0%, #005a99 100%); 
                            color: white; 
                            padding: 14px 18px; 
                            border-radius: 10px; 
                            margin: -18px -18px 15px -18px;
                            box-shadow: 0 4px 12px rgba(0, 121, 194, 0.4);">
                    <strong style="font-size: 17px;">${partner.name}</strong>
                    ${partner.count > 1 ? `<span style="background: rgba(255,255,255,0.25); padding: 5px 12px; border-radius: 18px; font-size: 13px; margin-left: 10px;">${partner.count} партнёр${partner.count > 4 ? 'ов' : 'а'}</span>` : ''}
                </div>
                <div style="color: #2c3e50; line-height: 1.7; font-size: 14px;">${partner.companies || ''}</div>
            </div>
        `;

        var iconSvg = `
            <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <radialGradient id="glow${Math.random()}">
                        <stop offset="0%" stop-color="#0079C2" stop-opacity="0.4"/>
                        <stop offset="70%" stop-color="#0079C2" stop-opacity="0.1"/>
                    </radialGradient>
                    <linearGradient id="grad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#0079C2"/>
                        <stop offset="100%" stop-color="#005a99"/>
                    </linearGradient>
                </defs>
                <circle cx="${size/2}" cy="${size/2}" r="${size/2 - 4}" fill="url(#glow${Math.random()})"/>
                <circle cx="${size/2}" cy="${size/2}" r="${size/2 - 8}" fill="url(#grad${Math.random()})" stroke="white" stroke-width="4"/>
                <circle cx="${size/2}" cy="${size/2}" r="${size/2 - 16}" fill="white" opacity="0.95"/>
                <text x="${size/2}" y="${size/2 + 5}" text-anchor="middle" font-size="${size > 55 ? 18 : 15}" font-weight="bold" fill="#0079C2">${partner.count}</text>
            </svg>
        `;

        var placemark = new ymaps.Placemark(
            partner.coords,
            { balloonContent: balloonContent, hintContent: partner.name },
            {
                iconLayout: 'default#image',
                iconImageHref: 'data:image/svg+xml;base64,' + btoa(iconSvg),
                iconImageSize: [size, size],
                iconImageOffset: [-size/2, -size/2]
            }
        );
        myMap.geoObjects.add(placemark);
    });

    myMap.setBounds(myMap.geoObjects.getBounds(), { checkZoomRange: true, zoomMargin: 50 });
}
</script>
{% endblock %}
