{% extends 'base.html' %}
{% load static %}

{% block title %}Новости кафедры{% endblock %}

{% block content %}

<h1 class="text-4xl font-bold text-center text-white mt-8 mb-4 p-4 bg-gradient-to-r from-blue-400 to-blue-500 rounded-lg shadow-lg animate__animated animate__fadeInDown">
    Новости кафедры
</h1>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    <template :key="post.id" x-for="post in posts">
        <div @click.stop="openModal(post)" class="bg-white rounded shadow p-4 news-card cursor-pointer">
            <img :src="post.image" alt="News Image" class="w-full h-48 object-cover rounded">
            <h2 class="text-xl font-semibold mt-4 underline-title"
                x-text="post.title.length > 50 ? post.title.substring(0, 50) + '...' : post.title"></h2>
            <p class="text-gray-700 mt-2" x-text="post.shortBody"></p>
            <div class="text-gray-500 text-sm mt-2 flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-eye mr-1"></i>
                    <span x-text="post.views"></span>
                </div>
                <span x-text="new Date(post.date * 1000).toLocaleDateString('ru-RU')"></span>
            </div>
        </div>
    </template>
    <template x-if="loading">
        <template :key="n" x-for="n in 6">
            <div class="max-w-sm p-4 border border-gray-200 rounded shadow animate-pulse md:p-6 dark:border-gray-700" role="status">
                <div class="flex items-center justify-center h-48 mb-4 bg-gray-300 rounded dark:bg-gray-700">
                    <svg aria-hidden="true" class="w-10 h-10 text-gray-200 dark:text-gray-600" fill="currentColor" viewBox="0 0 16 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14.066 0H7v5a2 2 0 0 1-2 2H0v11a1.97 1.97 0 0 0 1.934 2h12.132A1.97 1.97 0 0 0 16 18V2a1.97 1.97 0 0 0-1.934-2ZM10.5 6a1.5 1.5 0 1 1 0 2.999A1.5 1.5 0 0 1 10.5 6Zm2.221 10.515a1 1 0 0 1-.858.485h-8a1 1 0 0 1-.9-1.43L5.6 10.039a.978.978 0 0 1 .936-.57 1 1 0 0 1 .9.632l1.181 2.981.541-1a.945.945 0 0 1 .883-.522 1 1 0 0 1 .879.529l1.832 3.438a1 1 0 0 1-.031.988Z"/>
                        <path d="M5 5V.13a2.96 2.96 0 0 0-1.293.749L.879 3.707A2.98 2.98 0 0 0 .13 5H5Z"/>
                    </svg>
                </div>
                <div class="h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-48 mb-4"></div>
                <div class="h-2 bg-gray-200 rounded-full dark:bg-gray-700 mb-2.5"></div>
                <div class="h-2 bg-gray-200 rounded-full dark:bg-gray-700 mb-2.5"></div>
                <div class="h-2 bg-gray-200 rounded-full dark:bg-gray-700"></div>
            </div>
        </template>
    </template>
</div>

<div :class="{ 'active': isModalOpen }" @click.self="closeModal"
     class="modal fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center" tabindex="-1" x-ref="modal">
    <div @click.away="closeModal" class="bg-white rounded-lg shadow-lg p-6 w-11/12 md:w-2/3 lg:w-1/2 modal-content">
        <button @click="closeModal" aria-label="Close" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
            </svg>
        </button>
        <h2 class="text-2xl font-bold mb-4 text-center underline-title" x-text="modalContent.title"></h2>
        <div class="text-gray-500 text-sm mb-4 flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-eye mr-1"></i>
                <span x-text="modalContent.views"></span>
            </div>
            <span x-text="new Date(modalContent.date * 1000).toLocaleDateString('ru-RU')"></span>
        </div>
        <div class="text-gray-700 mb-4 whitespace-pre-line leading-relaxed" x-html="modalContent.body"></div>
        <div class="modal-image-container">
            <img :src="modalContent.image" @click="showFullImage = true" alt="News Image" class="modal-image">
        </div>
    </div>
</div>

<div :class="{ 'active': showFullImage }" @click="showFullImage = false" class="modal-image-full">
    <button @click.stop="showFullImage = false" aria-label="Close"
            class="absolute top-2 right-2 text-white hover:text-gray-200">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
        </svg>
    </button>
    <img :src="modalContent.image" alt="Full News Image">
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/news.js' %}"></script>
<script src="{% static 'js/navbar.js' %}"></script>
{% endblock %}
